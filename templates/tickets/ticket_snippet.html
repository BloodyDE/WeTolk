{# templates/tickets/ticket_snippet.html #}
{% load widget_tweaks %}
{% load bulletify %}

<div class="p-6 bg-white bg-opacity-90 rounded-2xl shadow-lg">

  <!-- Titel -->
  <h1 class="text-2xl font-bold text-indigo-700 mb-4">{{ ticket.title }}</h1>

  <!-- Metadaten -->
  <div class="text-sm text-gray-600 mb-6 space-y-1">
    <div>ğŸ‘¤ Erstellt von: {{ ticket.created_by.username }} am {{ ticket.created_at|date:"d.m.Y H:i" }}</div>
    <div>ğŸ“‚ Kategorie: {{ ticket.category }} â†’ {{ ticket.subcategory }}</div>
    <div>ğŸ—ï¸ Projekt: {{ ticket.project }} ({{ ticket.project_type }})</div>
  </div>

  <!-- Schlagworte -->
  {% if ticket.tag_list %}
  <div class="mb-6">
    <span class="font-semibold text-indigo-600">ğŸ·ï¸ Schlagworte:</span>
    <span class="inline-block ml-2 text-gray-800">
      {% for tag in ticket.tag_list %}
        <span class="bg-indigo-100 text-indigo-800 px-2 py-1 rounded mr-1">{{ tag }}</span>
      {% endfor %}
    </span>
  </div>
  {% endif %}

  <!-- Beschreibung -->
  <div class="mb-6">
    <h2 class="font-semibold text-gray-800 mb-2">ğŸ“‹ Beschreibung</h2>
    {{ ticket.description|bulletify }}
  </div>

  <!-- LÃ¶sung -->
  {% if ticket.solution %}
  <div class="mb-6">
    <h2 class="font-semibold text-gray-800 mb-2">ğŸ’¡ LÃ¶sung</h2>
    {{ ticket.solution|bulletify }}
  </div>
  {% endif %}

  <!-- Auswirkungen -->
  {% if ticket.impact %}
  <div class="mb-6">
    <h2 class="font-semibold text-gray-800 mb-2">âš¡ Auswirkungen</h2>
    {{ ticket.impact|bulletify }}
  </div>
  {% endif %}

  <!-- Anhang zum Download -->
  {% if ticket.attachment %}
  <div class="mb-6">
    <h2 class="font-semibold text-gray-800 mb-2">ğŸ“ Anhang</h2>
    <a href="{{ ticket.attachment.url }}" download
       class="text-indigo-600 hover:underline">
      {{ ticket.attachment.name|cut:"attachments/" }}
    </a>
  </div>
  {% endif %}

  <!-- Kommentare -->
  <div class="mb-6 border-t pt-4">
    <h2 class="text-xl font-bold text-indigo-700 mb-4">ğŸ’¬ Kommentare</h2>
    {% for comment in ticket.comments.all %}
      <div class="mb-4">
        <div class="text-sm text-gray-600">
          {{ comment.created_at|date:"d.m.Y H:i" }} â€“ {{ comment.created_by.username }}
        </div>
        <div class="ml-4 text-gray-800 whitespace-pre-wrap">
          {{ comment.message }}
        </div>
      </div>
    {% empty %}
      <div class="text-gray-600 italic">Noch keine Kommentare.</div>
    {% endfor %}
  </div>

  <!-- Kommentar-Formular -->
  <div class="border-t pt-4">
    <h2 class="text-xl font-bold text-indigo-700 mb-4">ğŸ’¬ Kommentar hinzufÃ¼gen</h2>
    <form method="post"
          hx-post="{% url 'tickets:ticket_snippet' ticket.pk %}"
          hx-target="#detail-pane"
          class="space-y-4">
      {% csrf_token %}
      {{ comment_form.non_field_errors }}
      {{ comment_form.message.label_tag }}
      {{ comment_form.message|add_class:"w-full p-2 border rounded h-24 focus:ring-4 focus:ring-indigo-200" }}
      <button type="submit"
              class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition">
        Senden
      </button>
    </form>
  </div>

</div>
