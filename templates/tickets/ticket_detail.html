{% extends "base.html" %}
{% load widget_tweaks %}
{% block title %}🎫 {{ ticket.title }} – Knowledge Base{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto py-8">
  <h1 class="text-3xl font-bold text-indigo-700 mb-4">{{ ticket.title }}</h1>
  <p class="text-sm text-gray-600 mb-6">
    👤 von {{ ticket.created_by.username }} am {{ ticket.created_at|date:"d.m.Y H:i" }}
  </p>

  <dl class="space-y-4">
    <div>
      <dt class="font-semibold text-gray-800">Kategorie</dt>
      <dd class="pl-4">{{ ticket.category }} &rarr; {{ ticket.subcategory }}</dd>
    </div>
    <div>
      <dt class="font-semibold text-gray-800">Projekt</dt>
      <dd class="pl-4">{{ ticket.project }} ({{ ticket.project_type }})</dd>
    </div>
    {% if ticket.tag_list %}
  <div>
    <dt class="font-semibold text-gray-800">🏷️ Schlagworte</dt>
    <dd class="pl-4 flex flex-wrap gap-2">
      {% for tag in ticket.tag_list %}
        <span class="bg-indigo-100 text-indigo-800 px-2 py-1 rounded">{{ tag }}</span>
      {% endfor %}
    </dd>
  </div>
{% endif %}
    <div>
      <dt class="font-semibold text-gray-800">Beschreibung</dt>
      <dd class="pl-4">{{ ticket.description|linebreaks }}</dd>
    </div>
    <div>
      <dt class="font-semibold text-gray-800">Lösung</dt>
      <dd class="pl-4">{{ ticket.solution|linebreaks }}</dd>
    </div>
    <div>
      <dt class="font-semibold text-gray-800">Auswirkungen</dt>
      <dd class="pl-4">{{ ticket.impact|linebreaks }}</dd>
    </div>
    {% if ticket.attachment %}
    <div>
      <dt class="font-semibold text-gray-800">Anhang</dt>
      <dd class="pl-4">
        <a href="{{ ticket.attachment.url }}" download class="text-indigo-600 hover:underline">
          📎 {{ ticket.attachment.name|slice:"-30:" }}
        </a>
      </dd>
    </div>
    {% endif %}
  </dl>

  <!-- Kommentare & Kommentar-Formular -->
  <div class="mt-10">
    <h2 class="text-2xl font-bold text-indigo-700 mb-4">💬 Kommentare</h2>
    <ul class="space-y-4 mb-6">
      {% for c in ticket.comments.all %}
      <li class="p-4 bg-gray-50 rounded">
        <p class="text-sm text-gray-600">{{ c.created_by.username }} • {{ c.created_at|date:"d.m.Y H:i" }}</p>
        <p class="mt-2">{{ c.message|linebreaks }}</p>
      </li>
      {% empty %}
      <li class="italic text-gray-500">Bisher keine Kommentare.</li>
      {% endfor %}
    </ul>

    <h3 class="text-xl font-semibold mb-2">Neuen Kommentar hinzufügen</h3>
    <form method="post" action="">
      {% csrf_token %}
      {{ comment_form.non_field_errors }}
      {{ comment_form.message.label_tag }}
      {{ comment_form.message|add_class:"w-full p-2 border rounded h-24 focus:ring-2 focus:ring-indigo-200" }}
      <button type="submit"
              class="mt-4 bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600 transition">
        Senden
      </button>
    </form>
  </div>
</div>
{% endblock %}
